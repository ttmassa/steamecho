<Window 
    x:Class="SteamEcho.App.Views.GameSelectionDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Select Game" Height="500" Width="400" WindowStartupLocation="CenterOwner" Background="#2B2B2C"
>
    <Window.Resources>
        <!-- Custom vertical scrollbar style -->
        <Style TargetType="ScrollBar" x:Key="CustomVerticalScrollBar">
            <Setter Property="Orientation" Value="Vertical"/>
            <Setter Property="Width" Value="4"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollBar">
                        <Grid Background="Transparent">
                            <Track x:Name="PART_Track" IsDirectionReversed="true" Focusable="false">
                                <Track.DecreaseRepeatButton>
                                    <RepeatButton Visibility="Collapsed" IsTabStop="False"/>
                                </Track.DecreaseRepeatButton>
                                <Track.Thumb>
                                    <Thumb Height="25" Cursor="Hand" VerticalAlignment="Top">
                                        <Thumb.Template>
                                            <ControlTemplate TargetType="Thumb">
                                                <Border Background="#F0F0F0" CornerRadius="5" Width="8"/>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                    </Thumb>
                                </Track.Thumb>
                                <Track.IncreaseRepeatButton>
                                    <RepeatButton Visibility="Collapsed" IsTabStop="False"/>
                                </Track.IncreaseRepeatButton>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ListBoxItem Style -->
        <Style TargetType="ListBoxItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border Background="{TemplateBinding Background}">
                            <ContentPresenter Content="{TemplateBinding Content}" ContentTemplate="{TemplateBinding ContentTemplate}" HorizontalAlignment="Stretch"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#4A4A4D"/>
                    <Setter Property="Cursor" Value="Hand"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#4A4A4D"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- ListBox Style -->
        <Style TargetType="ListBox" x:Key="GameListBoxStyle">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBox">
                        <Border Background="{TemplateBinding Background}" BorderThickness="{TemplateBinding BorderThickness}" BorderBrush="{TemplateBinding BorderBrush}">
                            <ScrollViewer Focusable="false" Padding="{TemplateBinding Padding}" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                                <ItemsPresenter/>
                            </ScrollViewer>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Select Button Style -->
        <Style TargetType="Button" x:Key="SelectButtonStyle">
            <Setter Property="Background" Value="#E63946"/>
            <Setter Property="Foreground" Value="#F0F0F0"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Regular"/>
            <Setter Property="Width" Value="100"/>
            <Setter Property="Height" Value="38"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="6" SnapsToDevicePixels="True">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" RecognizesAccessKey="True"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid Margin="0">
        <Grid.RowDefinitions>
            <!-- Title -->
            <RowDefinition Height="Auto"/>
            <!-- Game List -->
            <RowDefinition Height="*"/>
            <!-- Select Button -->
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Title -->
        <TextBlock Grid.Row="0" Text="Select a Game" Foreground="#F0F0F0" FontSize="26" FontWeight="Medium" HorizontalAlignment="Center" Margin="20,20,20,10"/>

        <!-- Game List -->
        <ListBox Grid.Row="1" x:Name="GamesListBox" Background="#2B2B2C" BorderThickness="0" Margin="20,0,20,0" ItemsSource="{Binding Games}" SelectedItem="{Binding SelectedGame, Mode=TwoWay}" ScrollViewer.VerticalScrollBarVisibility="Auto" ScrollViewer.HorizontalScrollBarVisibility="Disabled" Style="{StaticResource GameListBoxStyle}">

            <ListBox.Resources>
                <Style TargetType="ScrollBar" BasedOn="{StaticResource CustomVerticalScrollBar}" />
            </ListBox.Resources>

            <ListBox.ItemTemplate>
                <DataTemplate>
                    <StackPanel Orientation="Horizontal" Margin="0,8,0,8" VerticalAlignment="Center" Width="340">
                        <Image Width="56" Height="84" Margin="0,0,16,0">
                            <Image.Style>
                                <Style TargetType="Image">
                                    <Setter Property="Source" Value="{Binding IconUrl}"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IconUrl}" Value="{x:Null}">
                                            <Setter Property="Source" Value="/SteamEcho.App;component/Assets/Images/library_placeholder.png"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding IconUrl}" Value="">
                                            <Setter Property="Source" Value="/SteamEcho.App;component/Assets/Images/library_placeholder.png"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Image.Style>
                        </Image>
                        <StackPanel Orientation="Vertical" VerticalAlignment="Center" Width="260">
                            <TextBlock Text="{Binding Name}" Foreground="#F0F0F0" FontSize="16" FontWeight="Regular" Margin="0,0,0,2" TextTrimming="CharacterEllipsis" TextWrapping="NoWrap" Width="250"/>
                        </StackPanel>
                    </StackPanel>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>

        <!-- Select Button -->
        <Button Grid.Row="2" Content="Select" HorizontalAlignment="Center" VerticalAlignment="Bottom" Margin="0,24,0,24" Click="SelectButton_Click" Style="{StaticResource SelectButtonStyle}"/>
    </Grid>
</Window>